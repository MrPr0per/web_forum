{% extends "base.html" %}
{%block content%}
    <form action="messenge_to/{{section}}/0" method="post">
        <button type="submit" class="position_center borders">написать пост</button>
    </form>

    <p>
      <button class="btn btn-primary" type="button" data-bs-toggle="collapse" data-bs-target="#collapseExample" aria-expanded="false" aria-controls="collapseExample">
        Button with data-bs-target
      </button>
    </p>
    <div class="collapse" id="collapseExample">
      <div class="card card-body">
        Some placeholder content for the collapse component. This panel is hidden by default but revealed when the user activates the relevant trigger.
      </div>
    </div>

    {% for deep, post, hidden_button_val in format_posts%}
        {%if deep > 0%}
            {%set a = namespace(foo=False)%}
            {%for k, v in hidden_posts.items()%}
                {%if post.id in v%}
                    {% set a.foo = True %}
                {%endif%}
            {%endfor%}
            {%if a.foo == False or deep==1 %}

                <div style="margin-left: {{100 * (deep-1)}}px;" class="col-md6 border rounded">
                    <img src={{post.files}} alt="нет_картинки" width="150">
                    <h2>{{post.title}}</h2>
                    <div>
                        {{post.content}}
                    </div>
                    <div style="color:red;">
                        {%if post.blessing%}
                            пост благославлен следующими модераторами:
                            {{post.blessing}}
                        {%endif%}
                    </div>
                    <form action="messenge_to/{{section}}/{{post.id}}" method="post">
                        <button type="submit" class="position_center borders">ответить</button>
                    </form>

                    {%if deep == 1%}
                        <form action="" method="post" novalidate>
                            <div>
                                {{ form2.csrf_token }}
                            </div>
                            {% for field in form2 if field.name != 'csrf_token' %}
                                <div>
                                    {{ field() }}
                                </div>
                            {% endfor %}
                            <div><input type="hidden" name="data" value="2"></div>
                            <div><input type="hidden" name="index" value="{{loop['index0']}}"></div>
                        </form>
                    {%endif%}
                    {% if current_user.is_authenticated %}
                        <form action="" method="post" novalidate>
                            <div>
                                {{ form2.csrf_token }}
                            </div>
                            {% for field in bless if field.name != 'csrf_token' %}
                                <div>
                                    {{ field() }}
                                </div>
                            {% endfor %}
                            <div><input type="hidden" name="name" value={{current_user.nickname}}></div>
                            <div><input type="hidden" name="index2" value={{post.id}}></div>
                        </form>
                    {%endif%}
                </div>
            {%endif%}
        {%endif%}
    {% endfor %}
{%endblock%}
